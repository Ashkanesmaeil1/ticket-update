{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "ورود" %} - {% trans "سیستم تیکت" %}{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        direction: rtl;
        text-align: right;
    }
    
    main {
        width: 100%;
        display: flex;
        justify-content: center;
        max-width: 100%;
    }

    .login-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        width: 100%;
        max-width: 25rem;
    }
    
    .login-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        text-align: center;
    }
    
    .login-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
    }
    
    .login-header p {
        margin: 0.5rem 0 0 0;
        opacity: 0.9;
    }
    
    .login-body {
        padding: 2rem;
    }
    
    .form-floating {
        margin-bottom: 1rem;
    }
    
    .form-floating .form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 1rem 0.75rem;
        height: auto;
    }
    
    .form-floating .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .form-floating label {
        padding: 1rem 0.75rem;
    }
    
    .btn-login {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 10px;
        padding: 0.75rem;
        font-weight: 600;
        font-size: 1.1rem;
        width: 100%;
        margin-top: 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .login-footer {
        text-align: center;
        padding: 1rem 2rem 2rem;
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .alert {
        border-radius: 10px;
        margin-bottom: 1rem;
    }
    
    /* Logout message styling removed */
    
    .icon-container {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
    }
    
    .icon-container i {
        font-size: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-header">
        <div class="icon-container">
            <img src="{% static 'admin/img/white-pargsStar.webp' %}" alt="Welcome" style="width: 50px; height: 50px; object-fit: contain;">
        </div>
        <h1>{% trans "ITSS" %}</h1>
        <p>{% trans "به حساب کاربری خود وارد شوید" %}</p>
    </div>
    
    <div class="login-body">
        {% if messages %}
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    {% for message in messages %}
                        showNotification('{{ message|escapejs }}', '{{ message.tags }}');
                    {% endfor %}
                });
            </script>
        {% endif %}
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-floating position-relative mb-3">
                <input type="password" name="national_id" maxlength="10" minlength="10" pattern="\d{10}" inputmode="numeric" class="form-control" id="{{ form.national_id.id_for_label }}" placeholder="" autocomplete="off" required>
                <label for="{{ form.national_id.id_for_label }}">
                    <i class="fas fa-id-card me-2"></i>{% trans "کد ملی" %}
                </label>
                <button type="button" class="btn btn-outline-secondary btn-sm position-absolute top-50 end-0 translate-middle-y me-2 toggle-visibility" tabindex="-1" data-target="{{ form.national_id.id_for_label }}">
                    <i style="display: flex; align-items: center; justify-content: center; height: 22px; width: 23px;" class="fas fa-eye-slash"></i>
                </button>
                {% if form.national_id.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.national_id.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-floating position-relative mb-3">
                <input type="password" name="employee_code" maxlength="4" minlength="4" pattern="\d{4}" inputmode="numeric" class="form-control" id="{{ form.employee_code.id_for_label }}" placeholder="" autocomplete="off" required>
                <label for="{{ form.employee_code.id_for_label }}">
                    <i class="fas fa-user-tag me-2"></i>{% trans "کد پرسنلی" %}
                </label>
                <button type="button" class="btn btn-outline-secondary btn-sm position-absolute top-50 end-0 translate-middle-y me-2 toggle-visibility" tabindex="-1" data-target="{{ form.employee_code.id_for_label }}">
                    <i style="display: flex; align-items: center; justify-content: center; height: 22px; width: 23px;" class="fas fa-eye-slash"></i>
                </button>
                {% if form.employee_code.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.employee_code.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            
            <button type="submit" class="btn btn-primary btn-login">
                <i class="fas fa-sign-in-alt me-2"></i>{% trans "ورود" %}
            </button>
        </form>
    </div>
    
    <div class="login-footer">
        <!-- <p><i class="fas fa-shield-alt me-1"></i>{% trans "ورود امن" %}</p> -->
        <p class="mb-0">{% trans "نیاز به کمک دارید؟ با بخش IT تماس بگیرید" %}</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-focus on first input
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('{{ form.national_id.id_for_label }}').focus();
        
        // Logout message auto-hide removed
    });
    
    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const nationalId = document.getElementById('{{ form.national_id.id_for_label }}').value;
        const employeeCode = document.getElementById('{{ form.employee_code.id_for_label }}').value;
        
        if (!nationalId || !employeeCode) {
            e.preventDefault();
            alert('{% trans "لطفاً تمام فیلدها را پر کنید" %}');
            return false;
        }
        
        // Show loading state
        const submitBtn = document.querySelector('.btn-login');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{% trans "در حال ورود..." %}';
        submitBtn.disabled = true;
    });

    // Toggle visibility for password-like fields
    document.querySelectorAll('.toggle-visibility').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var targetId = btn.getAttribute('data-target');
            var input = document.getElementById(targetId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.querySelector('i').classList.remove('fa-eye-slash');
                btn.querySelector('i').classList.add('fa-eye');
            } else {
                input.type = 'password';
                btn.querySelector('i').classList.remove('fa-eye');
                btn.querySelector('i').classList.add('fa-eye-slash');
            }
        });
    });

    // Prevent non-numeric input for both fields
    function onlyAllowDigits(e) {
        if (e.inputType && e.inputType.startsWith('delete')) return;
        if (!/^[0-9]*$/.test(e.target.value)) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        }
    }
    document.getElementById('{{ form.national_id.id_for_label }}').addEventListener('input', onlyAllowDigits);
    document.getElementById('{{ form.employee_code.id_for_label }}').addEventListener('input', onlyAllowDigits);
</script>
{% endblock %} 