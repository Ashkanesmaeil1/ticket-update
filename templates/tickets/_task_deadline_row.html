{% load i18n %}
{% load persian_date %}
<div class="info-row">
    <div class="info-label">
        <i class="fas fa-clock me-2"></i>{% trans "مهلت انجام" %}
    </div>
    <div class="info-value">
        <div id="deadline-display" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
            <span id="deadline-countdown" style="font-weight: 600;"></span>
            <span style="color: #9ca3af;">|</span>
            <span id="deadline-date" style="color: #6b7280;">{{ task.deadline|persian_date }}</span>
            {% if task.deadline and task.is_deadline_expired and user.department_role == 'employee' and task.assigned_to.id == user.id %}
            <span id="extension-request-section">
                {% for ext_req in task.extension_requests.all %}
                {% if ext_req.requested_by.id == user.id and ext_req.status == 'pending' %}
                <span class="badge badge-info" style="margin-right: 0.5rem; background-color: #3b82f6; color: white; padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem;">
                    <i class="fas fa-hourglass-half me-1"></i>
                    {% trans "درخواست در حال بررسی" %}
                </span>
                {% endif %}
                {% endfor %}
            </span>
            <span id="extension-request-button" style="display: none;">
                <a href="{% url 'tickets:request_deadline_extension' task.id %}" class="btn btn-sm btn-warning" style="margin-right: 0.5rem; background-color: #f59e0b; border-color: #f59e0b; color: white; padding: 0.375rem 0.75rem; font-size: 0.875rem;">
                    <i class="fas fa-clock me-1"></i>
                    {% trans "درخواست تمدید" %}
                </a>
            </span>
            <script>
                (function () {
                    var hasPending = false;
                    {% for ext_req in task.extension_requests.all %}
                    {% if ext_req.requested_by.id == user.id and ext_req.status == 'pending' %}
                    hasPending = true;
                    {% endif %}
                    {% endfor %}
                    if (!hasPending) {
                        document.getElementById('extension-request-button').style.display = 'inline-block';
                    }
                })();
            </script>
            {% endif %}
        </div>
    </div>
</div>
