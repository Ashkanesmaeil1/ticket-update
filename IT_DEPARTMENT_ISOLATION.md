# جداسازی بخش IT از سایر بخش‌ها

این سند توضیح می‌دهد که چگونه بخش IT به عنوان یک بخش جداگانه عمل می‌کند و تیکت‌های سایر بخش‌ها در داشبورد مدیر IT نمایش داده نمی‌شوند.

## تغییرات اعمال شده

### 1. شناسایی بخش IT
تابع `get_it_department()` بخش IT را با جستجوی:
- بخش‌هایی که نام آن‌ها شامل "IT" است
- یا اولین بخش فنی که `can_receive_tickets=True` دارد

### 2. فیلتر تیکت‌ها برای مدیر IT
مدیر IT فقط تیکت‌های زیر را می‌بیند:
- تیکت‌هایی که `target_department` ندارند (تیکت‌های قدیمی که به IT ارسال می‌شدند)
- تیکت‌هایی که `target_department = بخش IT` است
- تیکت‌هایی که خود مدیر IT ایجاد کرده است

### 3. فیلتر تیکت‌ها برای کارشناسان فنی
کارشناسان فنی فقط تیکت‌های بخش IT را می‌بینند (تیکت‌هایی که به آن‌ها تخصیص داده شده و مربوط به بخش IT هستند).

### 4. اطلاع‌رسانی به سرپرست بخش
هنگامی که کاربر تیکتی برای بخشی غیر از IT ایجاد می‌کند:
- به جای مدیر IT، سرپرست (senior) آن بخش مطلع می‌شود
- سرپرست بخش می‌تواند تیکت‌های دریافتی را در بخش "تیکت‌های دریافتی" مشاهده کند

### 5. ویوهای به‌روزرسانی شده

#### Dashboard (داشبورد)
- مدیر IT: فقط تیکت‌های بخش IT
- کارشناس فنی: فقط تیکت‌های بخش IT که به او تخصیص داده شده
- سرپرست بخش: تیکت‌های دریافتی بخش خود

#### Ticket List (لیست تیکت‌ها)
- مدیر IT: فقط تیکت‌های بخش IT
- کارشناس فنی: فقط تیکت‌های بخش IT

#### Ticket Detail (جزئیات تیکت)
- مدیر IT: فقط می‌تواند تیکت‌های بخش IT را مشاهده کند
- کارشناس فنی: فقط می‌تواند تیکت‌های بخش IT که به او تخصیص داده شده را مشاهده کند

#### View All Replies (مشاهده تمام پاسخ‌ها)
- مدیر IT: فقط پاسخ‌های مربوط به تیکت‌های بخش IT

## نحوه راه‌اندازی

1. **ایجاد بخش IT**:
   - از "مدیریت بخش‌ها" یک بخش جدید ایجاد کنید
   - نام آن را "IT" یا "بخش IT" قرار دهید
   - نوع بخش را "بخش فنی" انتخاب کنید
   - یک شعبه برای آن انتخاب کنید (الزامی)
   - چک‌باکس "می‌تواند تیکت دریافت کند" را فعال کنید

2. **ایجاد سایر بخش‌ها**:
   - برای هر بخش، یک شعبه انتخاب کنید
   - در صورت نیاز، چک‌باکس "می‌تواند تیکت دریافت کند" را فعال کنید
   - مطمئن شوید که سرپرست (senior) برای هر بخش تعریف شده است

3. **تست**:
   - تیکتی برای بخش IT ایجاد کنید → باید در داشبورد مدیر IT نمایش داده شود
   - تیکتی برای بخش دیگری ایجاد کنید → نباید در داشبورد مدیر IT نمایش داده شود
   - تیکت بخش دیگر باید در "تیکت‌های دریافتی" سرپرست آن بخش نمایش داده شود

## نکات مهم

- تیکت‌های قدیمی که `target_department` ندارند، به عنوان تیکت‌های IT در نظر گرفته می‌شوند (سازگاری با گذشته)
- اگر بخش IT پیدا نشود، سیستم به حالت قبلی برمی‌گردد و همه تیکت‌ها نمایش داده می‌شوند
- سرپرست هر بخش باید نقش `department_role='senior'` داشته باشد تا بتواند تیکت‌های دریافتی را ببیند


